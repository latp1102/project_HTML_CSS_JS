<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/project_05.css" />
  </head>
  <body>
    <div class="container">
      <menu class="menu">
        <div class="menu-Input">
          <h4>
            <img
              class="images-Input"
              src="../assets/public/images/image_01.png"
              alt=""
            />
            Study Tracket
          </h4>
        </div>
        <div class="menu-Inputs">
          <p>Quản lý tiến độ học tập</p>
          <a href="">
            <img src="../assets/public/icons/icon_07.png" alt="" />Thống kê</a
          >
          <a href=""
            ><img src="../assets/public/icons/icon_21.png" alt="" />Quản lý môn
            học</a
          >
          <a href=""
            ><img src="../assets/public/icons/icon_09.png" alt="" />Quản lý bài
            học</a
          >
        </div>
      </menu>
      <div class="content">
        <header class="header">
          <div class="header-iconss">
            <img
              class="image_10"
              src="../assets/public/icons/icon_10.png"
              alt=""
            />
          </div>
          <div class="header-icons">
            <img src="../assets/public/icons/icon_11.png" alt="" />
            <img src="../assets/public/icons/icon_12.png" alt="" />
            <img src="../assets/public/icons/icon_13.png" alt="" />
            <img src="../assets/public/images/image_02.png" alt="" />
          </div>
        </header>
        <main class="main">
          <div class="category-manager">
            <div class="category-header">
              <h3 class="category-title">Bài học</h3>
              <div class="all">
                <select class="select">
                  <option value="">Lọc theo môn học</option>
                  <option value="">Đã hoàn thành</option>
                  <option value="">Chưa hoàn thành</option>
                </select>
                <button id="buttonAddCategory" class="button">
                  Thêm mới môn học
                </button>
              </div>
            </div>
          </div>
          <table border="1" class="category-table">
            <thead>
              <tr>
                <th><input type="checkbox" /></th>
                <th>
                  Tên môn học
                  <img src="../assets/public/icons/icon_16.png" alt="" />
                </th>
                <th>
                  Thời gian học
                  <img src="../assets/public/icons/icon_16.png" alt="" />
                </th>
                <th>Trạng thái</th>
                <th colspan="2">Chức năng</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><input checked type="checkbox" name="" id="" /></td>
                <td>Session 01-Tổng quan về HTML</td>
                <td>45</td>
                <td>
                  <div class="status status-active">
                    <img src="../assets/public/icons/icon_19.png" alt="" />
                    <span>Đã hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
              <tr>
                <td><input type="checkbox" name="" id="" /></td>
                <td>Session 02-Thẻ inline và Block</td>
                <td>60</td>
                <td>
                  <div class="status status-inactive">
                    <img src="../assets/public/icons/icon_20.png" alt="" />
                    <span>Chưa hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
              <tr>
                <td><input checked type="checkbox" name="" id="" /></td>
                <td>Session 03-Form và Table</td>
                <td>40</td>
                <td>
                  <div class="status status-active">
                    <img src="../assets/public/icons/icon_19.png" alt="" />
                    <span>Đã hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
              <tr>
                <td><input checked type="checkbox" /></td>
                <td>Session 04-CSS cơ bản</td>
                <td>45</td>
                <td>
                  <div class="status status-inactive">
                    <img src="../assets/public/icons/icon_20.png" alt="" />
                    <span>Chưa hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
              <tr>
                <td><input type="checkbox" /></td>
                <td>Session 05-CSS layout</td>
                <td>60</td>
                <td>
                  <div class="status status-inactive">
                    <img src="../assets/public/icons/icon_20.png" alt="" />
                    <span>Chưa hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
              <tr>
                <td><input type="checkbox" /></td>
                <td>Session 06-CSS Flex box</td>
                <td>45</td>
                <td>
                  <div class="status status-inactive">
                    <img src="../assets/public/icons/icon_20.png" alt="" />
                    <span>Chưa hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
              <tr>
                <td><input checked type="checkbox" /></td>
                <td>Session 12-Con trot trong C</td>
                <td>45</td>
                <td>
                  <div class="status status-active">
                    <img src="../assets/public/icons/icon_19.png" alt="" />
                    <span>Đã hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
              <tr>
                <td><input type="checkbox" /></td>
                <td>Session 15-Đọc và ghi file</td>
                <td>60</td>
                <td>
                  <div class="status status-inactive">
                    <img src="../assets/public/icons/icon_20.png" alt="" />
                    <span>Chưa hoàn thành</span>
                  </div>
                </td>
                <td>
                  <img
                    class="delete-button"
                    src="../assets/public/icons/icon_14.png"
                    alt=""
                  />
                  <img
                    class="edit-button"
                    src="../assets/public/icons/icon_15.png"
                    alt=""
                  />
                </td>
              </tr>
            </tbody>
          </table>
          <div class="pagination">
            <button class="button-prev">
              <img src="../assets/public/icons/icon_17.png" alt="" />
            </button>
            <button class="button-number active">1</button>
            <button class="button-number">2</button>
            <button class="button-number">3</button>
            <button class="button-number">4</button>
            <button class="button-number">5</button>
            <button class="button-number">6</button>
            <button class="button-number">7</button>
            <button class="button-number">...</button>
            <button class="button-number">20</button>
            <button class="button-next">
              <img src="../assets/public/icons/icon_18.png" alt="" />
            </button>
          </div>
        </main>
      </div>
    </div>
    <div class="overlay" id="formCategory" style="display: none">
      <form class="form-category">
        <div class="form-header">
          <h3>Thêm mới bài học</h3>
        </div>
        <div class="form-body">
          <label for="">Tên bài học</label>
          <input
            type="text"
            id="subjectName"
            name="subjectName"
            placeholder="Session 10 -Cấu trúc điều kiện"
          />

          <label for="">Loại môn học</label>
          <select>
            <option type="a" value="">Lập trình C cơ bản</option>
          </select>

          <label for="">Thời gian học</label>
          <input type="number" id="time" name="time" placeholder="45" />

          <label>Trạng thái:</label>
          <div class="status-group">
            <input
              type="radio"
              id="active"
              name="status"
              value="active"
              checked
            />
            <label for="active">Đã hoàn thành</label>
            <input type="radio" id="inactive" name="status" value="inactive" />
            <label for="inactive">Chưa hoàn thành</label>
          </div>
        </div>
        <div class="form-footer">
          <button type="button" id="btnCloseFormCategory">Hủy</button>
          <button type="button" id="btnAddSubject">Thêm</button>
        </div>
      </form>
    </div>
    <script>
     document.addEventListener("DOMContentLoaded", () => {
    const buttonAddCategory = document.getElementById("buttonAddCategory");
    const formCategory = document.getElementById("formCategory");
    const btnCloseFormCategory = document.getElementById("btnCloseFormCategory");
    const btnAddSubject = document.getElementById("btnAddSubject");
    const subjectTableBody = document.querySelector(".category-table tbody");

    // Mở modal
    buttonAddCategory.addEventListener("click", () => {
        formCategory.style.display = "flex";
        document.getElementById("subjectName").value = "";
        document.getElementById("time").value = "";
        formCategory.dataset.editingRow = null; //Reset editing row
        resetErrorMessages(); // Xóa thông báo lỗi cũ
    });

    // Đóng modal
    function closeForm() {
        formCategory.style.display = "none";
        resetErrorMessages(); // Xóa thông báo lỗi khi đóng form
    }

    btnCloseFormCategory.addEventListener("click", closeForm);

    // Thêm môn học vào danh sách
    btnAddSubject.addEventListener("click", () => {
        const subjectName = document.getElementById("subjectName").value.trim();
        const status = document.querySelector('input[name="status"]:checked').value;
        const time = document.getElementById("time").value; // Lấy thời gian học
        const subjectType = document.querySelector("select").value; // Lấy loại môn học

        // Kiểm tra và hiển thị thông báo lỗi
        let hasError = false;
        if (subjectName === "") {
            showErrorMessage("subjectName", "Vui lòng nhập tên môn học");
            hasError = true;
        } else {
            hideErrorMessage("subjectName");
        }

        if (time === "") {
            showErrorMessage("time", "Vui lòng nhập thời gian học");
            hasError = true;
        } else {
            hideErrorMessage("time");
        }

        if (hasError) {
            return; // Dừng thêm nếu có lỗi
        }

        if (formCategory.dataset.editingRow) {
            // Edit row.
            const row = subjectTableBody.querySelector(`tr[data-id="${formCategory.dataset.editingRow}"]`);
            if (row) {
                row.children[1].textContent = subjectName;
                row.children[2].textContent = time; // Cập nhật thời gian học
                row.children[3].textContent = status === "active" ? "Đã hoàn thành" : "Chưa hoàn thành";
            }
            formCategory.dataset.editingRow = null;
        } else {
            // Thêm hàng mới vào bảng
            const newId = Date.now(); // Tạo ID duy nhất
            const newRow = document.createElement("tr");
            newRow.setAttribute("data-id", newId); // Lưu ID vào thuộc tính data-id
            newRow.innerHTML = `
                <td><input type="checkbox"></td>
                <td>${subjectName}</td>
                <td>${time}</td>
                <td>${status === "active" ? "Đã hoàn thành" : "Chưa hoàn thành"}</td>
                <td><img class="edit-button" src="../assets/public/icons/icon_14.png" alt=""></td>
                <td><img class="delete-button" src="../assets/public/icons/icon_15.png" alt=""></td>
            `;
            subjectTableBody.appendChild(newRow);
        }
        closeForm();
        setupEventListeners(); // Cập nhật sự kiện cho hàng mới
    });

    function setupEventListeners() {
        // Xóa sự kiện cũ và thêm sự kiện mới
        subjectTableBody.querySelectorAll(".delete-button").forEach(button => {
            button.onclick = () => {
                const row = button.closest("tr");
                const subjectName = row.children[1].textContent; // Lấy tên môn học để hiển thị trong thông báo

                if (confirm(`Bạn có chắc chắn muốn xóa bài học "${subjectName}"?`)) {
                    row.remove();
                }
            };
        });

        subjectTableBody.querySelectorAll(".edit-button").forEach(button => {
            button.onclick = () => {
                const row = button.closest("tr");
                const subjectName = row.children[1].textContent;
                const status = row.children[3].textContent === "Đã hoàn thành" ? "active" : "inactive";
                const time = row.children[2].textContent; // Lấy thời gian học từ hàng

                document.getElementById("subjectName").value = subjectName;
                document.getElementById("time").value = time; // Đặt giá trị thời gian học
                document.querySelector(`input[name="status"][value="${status}"]`).checked = true;

                formCategory.style.display = "flex";
                formCategory.dataset.editingRow = row.getAttribute("data-id"); // Lưu ID vào dataset
            };
        });
    }

    // Hàm hiển thị thông báo lỗi
    function showErrorMessage(inputId, message) {
        const input = document.getElementById(inputId);
        input.classList.add("error");
        let errorSpan = input.nextElementSibling;
        if (!errorSpan || !errorSpan.classList.contains("error-message")) {
            errorSpan = document.createElement("span");
            errorSpan.classList.add("error-message");
            input.parentNode.appendChild(errorSpan);
        }
        errorSpan.textContent = message;
    }

    // Hàm ẩn thông báo lỗi
    function hideErrorMessage(inputId) {
        const input = document.getElementById(inputId);
        input.classList.remove("error");
        const errorSpan = input.nextElementSibling;
        if (errorSpan && errorSpan.classList.contains("error-message")) {
            errorSpan.textContent = "";
        }
    }

    // Hàm xóa tất cả thông báo lỗi
    function resetErrorMessages() {
        const errorMessages = document.querySelectorAll(".error-message");
        errorMessages.forEach(message => message.textContent = "");
        const errorInputs = document.querySelectorAll(".error");
        errorInputs.forEach(input => input.classList.remove("error"));
    }

    setupEventListeners(); // Thiết lập sự kiện ban đầu
});
    </script>
  </body>
</html>
