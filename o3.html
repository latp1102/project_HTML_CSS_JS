<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/project_04.css">
</head>
<body>
    <div class="container">
        <menu class="menu">
            <h4>
                <img class="images-Input" src="../assets/public/images/image_01.png" alt="">
                Study Tracket
            </h4>
            <p>Quản lý tiến độ học tập</p>
            <a href=""> <img src="../assets/public/icons/icon_07.png" alt="">Thống kê</a>
            <a href=""><img src="../assets/public/icons/icon_08.png" alt="">Quản lý môn học</a>
            <a href=""><img src="../assets/public/icons/icon_09.png" alt="">Quản lý bài học</a>
        </menu>
        <div class="content">
            <header class="header">
                <div class="header-iconss">
                    <img class="image_10" src="../assets/public/icons/icon_10.png" alt="">
                </div>
                <div class="header-icons">
                    <img src="../assets/public/icons/icon_11.png" alt="">
                    <img src="../assets/public/icons/icon_12.png" alt="">
                    <img src="../assets/public/icons/icon_13.png" alt="">
                    <img src="../assets/public/images/image_02.png" alt="">
                </div>
            </header>
            <main class="main">
                <div class="category-manager">
                    <div class="category-header">
                        <h3 class="category-title">Môn học</h3>
                        <button id="buttonAddCategory" class="button">
                            Thêm mới môn học
                        </button>
                    </div>
                    <div class="category-function">
                        <select class="select">
                            <option value="">Tất cả</option>
                            <option value="">Đang hoạt động</option>
                            <option value="">Ngừng hoạt động</option>
                        </select>
                        <div class="input-search-container">
                            <input
                                class="input-search"
                                type="text"
                                placeholder="Nhập từ khóa tìm kiếm"
                            />
                            <img class="image_00" src="../assets/public/icons/icon_00.png" alt="">
                        </div>
                    </div>
                </div>
                <table border="1" class="category-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên môn học <img src="../assets/public/icons/icon_16.png" alt=""></th>
                            <th>Trạng thái</th>
                            <th colspan="2">Chức năng</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Lập trình C</td>
                            <td>
                                <div class="status status-active">
                                    <img src="../assets/public/icons/icon_19.png" alt="">
                                    <span>Đang hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Lập trình Frontend với ReactJS</td>
                            <td>
                                <div class="status status-inactive">
                                    <img src="../assets/public/icons/icon_20.png" alt="">
                                    <span>Ngừng hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Lập trình Backend với Spring Boot</td>
                            <td>
                                <div class="status status-active">
                                    <img src="../assets/public/icons/icon_19.png" alt="">
                                    <span>Đang hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Lập trình Frontend với VueJS</td>
                            <td>
                                <div class="status status-inactive">
                                    <img src="../assets/public/icons/icon_20.png" alt="">
                                    <span>Ngừng hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>Cấu trúc dữ liệu và giải thuật</td>
                            <td>
                                <div class="status status-inactive">
                                    <img src="../assets/public/icons/icon_20.png" alt="">
                                    <span>Ngừng hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>Phân tích và thiết kế hệ thống</td>
                            <td>
                                <div class="status status-inactive">
                                    <img src="../assets/public/icons/icon_20.png" alt="">
                                    <span>Ngừng hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td>Toán cao cấp</td>
                            <td>
                                <div class="status status-active">
                                    <img src="../assets/public/icons/icon_19.png" alt="">
                                    <span>Đang hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                        <tr>
                            <td>8</td>
                            <td>Tiếng Anh chuyên ngành</td>
                            <td>
                                <div class="status status-inactive">
                                    <img src="../assets/public/icons/icon_20.png" alt="">
                                    <span>Ngừng hoạt động</span>
                                </div>
                            </td>
                            <td class="all">
                                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <button class="button-prev">
                        <img src="../assets/public/icons/icon_17.png" alt="">
                    </button>
                    <button class="button-number active">1</button>
                    <button class="button-number">2</button>
                    <button class="button-number">3</button>
                    <button class="button-number">4</button>
                    <button class="button-number">5</button>
                    <button class="button-number">6</button>
                    <button class="button-number">7</button>
                    <button class="button-number">...</button>
                    <button class="button-number">20</button>
                    <button class="button-next">
                        <img src="../assets/public/icons/icon_18.png" alt="">
                    </button>
                </div>
            </main>
        </div>
    </div>
    <div class="overlay" id="formCategory" style="display: none">
        <form class="form-category">
            <div class="form-header">
                <h3>Thêm mới môn học</h3>
            </div>
            <div class="form-body">
                <label for="subjectName">Tên môn học:</label>
                <input type="text" id="subjectName" name="subjectName" required />

                <label>Trạng thái:</label>
                <div class="status-group">
                    <input type="radio" id="active" name="status" value="active" checked/>
                    <label for="active">Đang hoạt động</label>
                    <input type="radio" id="inactive" name="status" value="inactive" />
                    <label for="inactive">Ngừng hoạt động</label>
                </div>
            </div>
            <div class="form-footer">
                <button type="button" id="btnCloseFormCategory">Hủy</button>
                <button type="button" id="btnAddSubject">Thêm</button>
            </div>
        </form>
    </div>
    <script>

document.addEventListener("DOMContentLoaded", () => {
    const buttonAddCategory = document.getElementById("buttonAddCategory");
    const formCategory = document.getElementById("formCategory");
    const btnCloseFormCategory = document.getElementById("btnCloseFormCategory");
    const btnAddSubject = document.getElementById("btnAddSubject");
    const subjectTableBody = document.querySelector(".category-table tbody");

    console.log("DOM loaded");

    const openForm = () => {
        console.log("openForm called");
        formCategory.style.display = "flex";
        document.getElementById("subjectName").value = "";
        formCategory.dataset.editingRow = null;
        document.getElementById("subjectNameError").style.display = "none"; // Ẩn thông báo lỗi khi mở form
    };

    const closeForm = () => {
        console.log("closeForm called");
        formCategory.style.display = "none";
    };

    const addSubject = () => {
        console.log("addSubject called");
        const subjectName = document.getElementById("subjectName").value.trim();
        const status = document.querySelector('input[name="status"]:checked').value;
        const subjectNameError = document.getElementById("subjectNameError");

        if (!subjectName) {
            subjectNameError.textContent = "Vui lòng nhập tên môn học.";
            subjectNameError.style.display = "block";
            return;
        } else {
            subjectNameError.style.display = "none";
        }

        if (subjectTableBody) {
            if (formCategory.dataset.editingRow) {
                const row = subjectTableBody.children[parseInt(formCategory.dataset.editingRow)];
                row.children[1].textContent = subjectName;
                updateStatusCell(row, status);
                formCategory.dataset.editingRow = null;
            } else {
                const newRow = createSubjectRow(subjectName, status);
                subjectTableBody.appendChild(newRow);
            }

            closeForm();
            setupEventListeners();
        } else {
            console.error("subjectTableBody is null. Table body not found.");
        }
    };

    const createSubjectRow = (subjectName, status) => {
        const newRow = document.createElement("tr");
        const newId = subjectTableBody.children.length + 1;
        newRow.innerHTML = `
            <td>${newId}</td>
            <td>${subjectName}</td>
            <td>${getStatusCellHtml(status)}</td>
            <td class="all">
                <img class="delete-button" src="../assets/public/icons/icon_14.png" alt="">
                <img class="edit-button" src="../assets/public/icons/icon_15.png" alt="">
            </td>
        `;
        return newRow;
    };

    const updateStatusCell = (row, status) => {
        row.querySelector(".status").outerHTML = getStatusCellHtml(status);
    };

    const getStatusCellHtml = (status) => {
        const isActive = status === "active";
        return `
            <div class="status ${isActive ? "status-active" : "status-inactive"}">
                <img src="../assets/public/icons/${isActive ? "icon_19.png" : "icon_20.png"}" alt="">
                <span>${isActive ? "Đang hoạt động" : "Ngừng hoạt động"}</span>
            </div>
        `;
    };

    const deleteSubject = (row) => {
        if (confirm("Bạn có chắc chắn muốn xóa môn học này?")) {
            row.remove();
        }
    };

    const editSubject = (row) => {
        const subjectName = row.children[1].textContent;
        const status = row.querySelector(".status").classList.contains("status-active") ? "active" : "inactive";

        document.getElementById("subjectName").value = subjectName;
        document.querySelector(`input[name="status"][value="${status}"]`).checked = true;

        openForm();
        formCategory.dataset.editingRow = Array.from(subjectTableBody.children).indexOf(row);
    };

    const setupEventListeners = () => {
        subjectTableBody.querySelectorAll(".delete-button").forEach(button => {
            button.onclick = () => deleteSubject(button.closest("tr"));
        });

        subjectTableBody.querySelectorAll(".edit-button").forEach(button => {
            button.onclick = () => editSubject(button.closest("tr"));
        });
    };

    buttonAddCategory.onclick = openForm;
    btnCloseFormCategory.onclick = closeForm;
    btnAddSubject.onclick = addSubject;

    if (subjectTableBody) {
        setupEventListeners();
    }
});
    </script>
</body>
</html>